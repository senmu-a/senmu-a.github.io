import{_ as n,p as s,q as a,Y as p}from"./framework-aa5c4115.js";const t={},e=p(`<h2 id="raptor-使用-vue-cli-启动过程" tabindex="-1"><a class="header-anchor" href="#raptor-使用-vue-cli-启动过程" aria-hidden="true">#</a> Raptor 使用 Vue Cli 启动过程</h2><p>项目使用 <code>vue-cli-service serve --open</code> 启动，该命令会自动加载项目中与 <code>package.json</code> 同级目录下的 <code>vue.config.js</code> 文件。当然，也可以在 <code>package.json</code> 中配置 <code>vue</code> 字段来配置相关功能，这种方式不太好，暂时不做研究。</p><p>分析 <code>vue.config.js</code> 文件中的配置</p><h3 id="publicpath" tabindex="-1"><a class="header-anchor" href="#publicpath" aria-hidden="true">#</a> publicPath</h3><blockquote><p>Tip：有的项目中中可能是 <code>baseUrl</code>，但是从 Vue CLI 3.3 起就已经弃用该字段</p></blockquote><p>部署包时的基本 URL。举例子：项目在被打包后指定访问资源的路径，我们项目打包后被部署到 <code>https://www.qiandu.com/</code>，那么我们将该值设置为 <code>&#39;/&#39;</code> 则就会在跟路径上访问资源；而如果项目打包后被部署到 <code>https://www.qiandu.com/my-app/</code>，则就应该将该值设置为 <code>&#39;/my-app/&#39;</code>。</p><p>上面讲的都是绝对路径的情况，该值还可以被设置为 <code>&#39;&#39;</code>或者<code>&#39;./&#39;</code>，这样所有的的资源都会被链接为相对路径，而这样打包出来的资源也就可以被部署到任何路径上。<strong>但是</strong>，这种情况需要额外注意不可以在 <code>history</code> 路由中使用。为什么？因为 <code>history</code> 的路由一般是 <code>https://www.qiandu.com/my-app/app</code>，如果设置为相对路径那么就会尝试在 <code>/app</code> 目录下查找资源，这会导致资源找不到。</p><h3 id="lintonsave" tabindex="-1"><a class="header-anchor" href="#lintonsave" aria-hidden="true">#</a> lintOnSave</h3><p>影响开发时（<code>vue-cli-service serve</code>）保存文件是否使用 <code>eslint-loader</code> lint 代码，它受 <code>@vue/cli-plugin-eslint</code> 插件影响。</p><h3 id="css-extract" tabindex="-1"><a class="header-anchor" href="#css-extract" aria-hidden="true">#</a> css.extract</h3><blockquote><p>通常情况下，开发环境为 <code>false</code>，表示 CSS 被嵌入到 JS 中以便支持热重载等功能；在生产环境构建时为 <code>true</code>，便于将 CSS 文件独立出去，使用 HTTP 缓存来缓存 CSS 资源，减少 JS 代码执行的负担。</p></blockquote><p>是否将 CSS 提取到一个单独的 CSS 文件中。</p><h3 id="css-loaderoptions" tabindex="-1"><a class="header-anchor" href="#css-loaderoptions" aria-hidden="true">#</a> css.loaderOptions</h3><p>预处理 CSS 的 loader 配置。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token literal-property property">css</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">loaderOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">sass</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">additionalData</span><span class="token operator">:</span> <span class="token string">&#39;@import \\&#39;@/styles/var.scss\\&#39;;@import \\&#39;@/styles/mix.scss\\&#39;;&#39;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的配置就是处理 <code>sass</code>、<code>scss</code> 文件，往每一个文件头部插入 <code>additionalData</code> 中的内容。</p><p>通常就是处理在头部导入公用变量等操作。</p><h3 id="chainwebpack" tabindex="-1"><a class="header-anchor" href="#chainwebpack" aria-hidden="true">#</a> chainWebpack</h3><p>可以对内部的 webpack 配置进行更加细粒度的修改。</p><p>例如：</p><ul><li>去除缓存 <strong>【防止缓存影响】</strong></li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>config<span class="token punctuation">.</span>module<span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span><span class="token string">&#39;vue&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>uses<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">&#39;cache-loader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
config<span class="token punctuation">.</span>module<span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span><span class="token string">&#39;js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>uses<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">&#39;cache-loader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>使用 <code>lodash</code> 的模块，去除无用模块 <strong>【性能优化】</strong></li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> LodashModuleReplacementPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;lodash-webpack-plugin&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
config<span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token string">&#39;lodashModuleReplacementPlugin&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LodashModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>开发环境中禁止 js 文件缓存 <strong>【防止缓存影响】</strong></li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&#39;production&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> filename <span class="token operator">=</span> <span class="token string">&#39;js/[name].[hash:8].js&#39;</span><span class="token punctuation">;</span>
  config<span class="token punctuation">.</span>output<span class="token punctuation">.</span><span class="token function">filename</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">chunkFilename</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>导出库的方式（<code>UMD</code>、<code>AMD</code>等方式）、库名、是否使用 <code>jsonpFunction</code> <strong>【名称统一】</strong></li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> packagename <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./package.json&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
config<span class="token punctuation">.</span>output
  <span class="token punctuation">.</span><span class="token function">library</span><span class="token punctuation">(</span>packagename<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">libbraryTarget</span><span class="token punctuation">(</span><span class="token string">&#39;UMD&#39;</span><span class="token punctuation">)</span>
  <span class="token comment">// 按需加在相关（默认名称为：webpackJsonp\${packagename}）</span>
  <span class="token punctuation">.</span><span class="token function">jsonpFunction</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">webpackJsonp_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>packagename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>某些第三方库不进行打包，单独引入 <strong>【性能优化】</strong></li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> externals <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">vue</span><span class="token operator">:</span> <span class="token string">&#39;Vue&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">&#39;vue-router&#39;</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token string">&#39;VueRouter&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">vuex</span><span class="token operator">:</span> <span class="token string">&#39;Vuex&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cdns <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;cdn url&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

config<span class="token punctuation">.</span><span class="token function">externals</span><span class="token punctuation">(</span>externals<span class="token punctuation">)</span><span class="token punctuation">;</span>
config<span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token string">&#39;html&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token parameter">args</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>cnds <span class="token operator">=</span> cdns<span class="token punctuation">;</span>
  <span class="token keyword">return</span> args<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>提取并压缩项目中的 css 到单独的文件，并设置 <code>publicPath</code> 解决资源路径引用问题 <strong>【性能优化】</strong></li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> cssAttr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;sass&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;scss&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;less&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;postcss&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;css&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;stylus&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cssRule <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;vue-modules&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;vue&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;normal-modules&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;normal&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
cssArr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  cssRule<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">rule</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    config<span class="token punctuation">.</span>module<span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">oneOf</span><span class="token punctuation">(</span>rule<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&#39;extract-css-loader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">loader</span><span class="token punctuation">(</span>MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token parameter">args</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            args<span class="token punctuation">.</span>publicPath <span class="token operator">=</span> publicPath<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> args<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>定义项目中的全局常量，便于在项目中的任何地方都可以使用该值 <strong>【易用性】</strong></li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 项目中可以在任意地方使用 p<wbr>rocess.env.PUBLIC_PATH 的值</span>
config<span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token string">&#39;define&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tag</span><span class="token punctuation">(</span><span class="token parameter">args</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;procrss.env&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token constant">PUBLIC_PATH</span> <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PUBLIC_PATH</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> args<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="configurewebpack" tabindex="-1"><a class="header-anchor" href="#configurewebpack" aria-hidden="true">#</a> configureWebpack</h3><p>webpack 的配置项，可以使用 <code>speed-measure-webpack-plugin</code> 库来统计打包数据，为性能优化提供帮助。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> SpeedMeasurePlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;speed-measure-webpack-plugin&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> smp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpeedMeasurePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">disable</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">{</span>
  <span class="token literal-property property">configureWebpack</span><span class="token operator">:</span> smp<span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">// ...plugins</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>

  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="devserver" tabindex="-1"><a class="header-anchor" href="#devserver" aria-hidden="true">#</a> devServer</h3><p>开发环境中提供的开发服务器，可以配置鉴权、代理等信息。</p>`,39),c=[e];function o(i,l){return s(),a("div",null,c)}const r=n(t,[["render",o],["__file","07-05.html.vue"]]);export{r as default};
