---
title: 微前端架构
date: 2025/03/16
author: senmu
---

## 概念

在随着项目的发展，我们的应用也会随之变得越来越巨大，那么对于项目的维护也会变得巨复杂。

而微前端方案可以将众多子应用拆分，独立部署，并且不限于技术栈，最终在主应用（基座）中展现。

## 微前端方案

### iframe

通信不方便，路由同步问题等影响用户体验。

### 路由分发（前端集成方案）

通过访问不同路由来加载不同子应用

### 基于 web components

隔离性很好！！！

但不同框架的 Web Components 兼容性可能有问题。

### Webpack5 模块联邦

适用于共享组件库等代码的场景，相比 `qiankun` 的方案：

- 代码仓库：他们都可以独立拆分不同项目进行独立部署
- 加载方式：
  - 模块联邦：运行时按需加载
  - `qiankun`：运行时加载整个子应用
- 共享依赖：
  - 模块联邦：可以共享依赖
  - `qiankun`：个子应用独立运行，可能会重复加载
- 通信方式：
  - 模块联邦：直接 `import()` 远程模块
  - `qiankun`：`window.postMessage`

### qiankun

基于 `single-spa` 来实现的微前端解决方案，内部封装了沙箱、通信。

#### 沙箱

主要是解决了多个子应用全局变量的污染问题、css 样式冲突等问题。

- `window` 污染问题：通过 `Proxy` 代理子应用的 `window`
  - 如果浏览器不支持 `Proxy` 可以利用一个空的 iframe 来劫持子应用的 `window` 然后再通过 `postmessage` 与主应用通信即可。
- css 样式隔离：css-scoped、shadow-dom

#### 通信

- 父子应用之间通信：`initGlobalState`、`props` 的方式
- 兄弟应用之间通信：
  - 可以使用事件订阅的方式通信，需要通过父应用实现事件总线，然后挂载到 `window` 中
  - 还有 `localstorage`
